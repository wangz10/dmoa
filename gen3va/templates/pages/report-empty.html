{% extends 'wrapper.html' %}

{% block title %}{{ drug.pert_iname }}{% endblock %}

{% block body %}
    
    <script src='static/lib/highcharts/highcharts.js'></script>
    <script src='static/lib/highcharts/highcharts-3d.js'></script>
    <script src='static/lib/highcharts/highcharts-exporting.js'></script>

    <script src='static/lib/d3/d3.js'></script>
    <script src='static/lib/underscore/underscore.js'></script>

    <script src='static/js/report.js'></script>
    <script>
        createAndManageVisualizations({
            barPlotDx: {{
                drug.get_dx_counts()|safe
                if drug.get_dx_counts()
                else 'undefined'                
            }},
            barPlotRx: {{
                drug.get_rx_counts()|safe
                if drug.get_rx_counts()
                else 'undefined'                
            }},

        });

    </script>

    <div class='page' id='report-page'>

        <div class='ribbon'>
            <div class='container'>
                <div class='report-metadata'>
                    <h1>
                        <strong>{{ drug.pert_iname|upper }} ({{ drug.pert_id }})</strong> <span>report</span>
                    </h1>
                    <div class="row">
                        <div class="col-md-8">
                            <h2>Overview</h2>
                            <dl class="dl-horizontal">
                                {% for key, value in drug.to_dict().items() %}
                                    <dt>{{ key }}</dt>
                                    <dd>{{ value }}</dd>
                                {% endfor %}
                            </dl>

                            <h2>External links</h2>
                            <dl class="dl-horizontal">
                                {% for key, (display_name, url) in drug.get_external_links().items() %}
                                    <dt>{{ key }}</dt>
                                    <dd><a href="{{ url }}" target="_blank">{{ display_name }}</a></dd>
                                {% endfor %}
                            </dl>
                        </div>

                        <div class="col-md-4">
                            <h2>Chemical structure</h2>
                            <img src="{{ drug.get_structure_url() }}">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <!-- Diagnosis count -->
            <div class='section'>
                <h2>Diagnoses</h2>
                <div class='description'>
                    <p>
                        Top diagnoses associated with {{ drug.pert_iname }}.
                    </p>
                </div>
                <div id='dx-plot'></div>
            </div>

            <!-- Co-prescribed drugs count -->
            <div class='section'>
                <h2>Co-prescribed drugs</h2>
                <div class='description'>
                    <p>
                        Top co-prescribed drugs of {{ drug.pert_iname }}.
                    </p>
                </div>
                <div id='rx-plot'></div>
            </div>
        </div>        

{% endblock %}